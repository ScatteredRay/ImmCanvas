<html>
<body>
<canvas id="formcanvas"/>
<script type="text/javascript">

  function transform_point(p)
  {
      return p;
  }

  function transform_xy(x, y)
  {
      return transform_point({"x" : x, "y" : y});
  }

  function draw_line(ctx, x1, y1, x2, y2) {
      var p1 = transform_xy(x1, y1);
      var p2 = transform_xy(x2, y2);
      ctx.beginPath();
      ctx.moveTo(p1.x, p1.y);
      ctx.lineTo(p2.x, p2.y);
      ctx.closePath();
      ctx.stroke();
  }

  var element_draw_fns =
  {"hline" :
  function(elem, ctx) {
      draw_line(ctx, elem.x, elem.y, elem.x + elem.length, elem.y);
  },
  "vline" :
  function(elem, ctx) {
      draw_line(ctx, elem.x, elem.y, elem.x, elem.y + elem.length);
  },
  "lwid" :
  function(elem, ctx) {
      ctx.lineWidth = elem.width;
  },
  "text" :
  function(elem, ctx) {
      var p = transform_xy(elem.x, elem.y);
      ctx.fillText(elem.text, p.x, p.y);
  }};

  function draw_pcl(pcl_elements, ctx) {
  
      function draw_pcl_element(elem) {
          element_draw_fns[elem.element](elem, ctx);
      }

      pcl_elements.forEach(draw_pcl_element);
  }

  var form = document.getElementById("formcanvas");
  var ctx = form.getContext("2d");

  var formdata =
  {"pcl" :
      [{"element" : "hline", "x" : 10, "y" : 10, "length" : 40},
       {"element" : "vline", "x" : 10, "y" : 10, "length" : 40},
       {"element" : "lwid", "width" : 4},
       {"element" : "hline", "x" : 10, "y" : 40, "length" : 40},
       {"element" : "text", "x" : 15, "y" : 40, "text" : "Testing"}]};

  draw_pcl(formdata.pcl, ctx);

</script>
</body>
</html>
